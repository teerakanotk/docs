---
title: "Firewall"
---

import { Steps, Callout } from "nextra/components";

# Proxmox VE Firewall

## หลักการทำงาน

### 1. ทำงานเป็นเลเยอร์ (Layered Architecture):

  - Datacenter Level: เป็นการตั้งค่าไฟร์วอลล์ระดับสูงสุด ซึ่งจะส่งผลกระทบต่อโหนดและ VM/Container ทั้งหมดในคลัสเตอร์ เว้นแต่จะมีการกำหนดกฎที่เฉพาะเจาะจงกว่าที่ระดับล่างลงไป
  - Node Level: การตั้งค่าไฟร์วอลล์เฉพาะสำหรับโหนด Proxmox VE แต่ละตัว คุณสามารถมีกฎที่แตกต่างกันสำหรับแต่ละโหนดในคลัสเตอร์
  - VM/Container Level: การตั้งค่าไฟร์วอลล์สำหรับ Virtual Machine (VM) หรือ Container (CT) แต่ละตัว ซึ่งเป็นระดับที่เฉพาะเจาะจงที่สุด

### 2. การสืบทอดกฎ (Rule Inheritance):

  - กฎที่กำหนดที่ระดับ Datacenter จะถูกสืบทอดไปยังโหนดและ VM/Container ทั้งหมด
  - กฎที่กำหนดที่ระดับ Node จะมีผลเหนือกว่ากฎ Datacenter สำหรับโหนดนั้นๆ
  - กฎที่กำหนดที่ระดับ VM/Container จะมีผลเหนือกว่ากฎ Node และ Datacenter สำหรับ VM/Container นั้นๆ

### 3. หลักการ "Default Deny" (ไม่อนุญาตโดยค่าเริ่มต้น):

  - โดยทั่วไป Proxmox VE Firewall จะใช้หลักการ "Default Deny" ซึ่งหมายความว่า หากคุณไม่ได้กำหนดกฎอนุญาต (ACCEPT) การเชื่อมต่อใดๆ อย่างชัดเจน การเชื่อมต่อเหล่านั้นจะถูกปฏิเสธ (DENY/REJECT) โดยอัตโนมัติ หลักการนี้ช่วยเพิ่มความปลอดภัยโดยบังคับให้ผู้ดูแลระบบต้องระบุ Traffic ที่อนุญาตเท่านั้น

### 4. การประเมินกฎ (Rule Evaluation Order):

- VM/Container Level (เฉพาะเจาะจงที่สุด): จะมีการตรวจสอบกฎที่กำหนดสำหรับ VM หรือ Container เป็นอันดับแรก

- Node Level: หากไม่พบกฎที่ตรงกันในระดับ VM/Container จะย้ายไปตรวจสอบกฎที่ระดับโหนด

- Datacenter Level (กว้างที่สุด): หากไม่พบกฎที่ตรงกันในระดับ Node จะย้ายไปตรวจสอบกฎที่ระดับ Datacenter

- ทันทีที่พบกฎที่ตรงกัน ระบบจะใช้กฎนั้นและหยุดการตรวจสอบกฎอื่นๆ เพิ่มเติม

## ขั้นตอนการเปิดใช้งาน Firewall และตั้งค่าเบื้องต้น

<Steps>

### เข้าสู่ระบบ Proxmox VE Web UI

- เปิดเว็บเบราว์เซอร์และไปที่ `https://<proxmox_ip_addr>:8006`
- เข้าสู่ระบบด้วยชื่อผู้ใช้และรหัสผ่านของคุณ

### เปิดใช้งาน Firewall ระดับ Datacenter

- ในเมนูด้านซ้ายมือ คลิกที่ `Datacenter`

- คลิกที่แท็บ `Firewall`

- เลือกช่อง `Enable Firewall` แล้วคลิก `Apply`

> **หมายเหตุ:** การเปิดใช้งาน ณ จุดนี้จะยังไม่บล็อกการเชื่อมต่อใดๆ

### ตรวจสอบและเพิ่มกฎ Firewall ที่จำเป็น (ระดับ Datacenter หรือ Node)

- **SSH (Port 22):** เพื่อให้คุณสามารถเข้าถึงโหนด Proxmox ผ่าน SSH ได้

- **Proxmox VE Web UI (Port 8006):** เพื่อให้คุณสามารถเข้าถึงหน้าเว็บ Proxmox ได้

- **VM/CT Traffic:** หากคุณต้องการให้ VM/CT ของคุณสามารถเข้าถึงอินเทอร์เน็ตหรือบริการอื่นๆ ได้

**ตัวอย่าง**

  - ที่แท็บ `Firewall`
  
  - คลิก `Add`
  
  - จะมีหน้าต่าง "Add Firewall Rule" ปรากฎขึ้นมา:
    - Type: เลือก `"In" (สำหรับ inbound traffic)` หรือ `"Out" (สำหรับ outbound traffic)`
    - Action: เลือก `ACCEPT`
</Steps>
