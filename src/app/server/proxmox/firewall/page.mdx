---
title: "Firewall"
---

import { Steps, Callout } from "nextra/components";

# Proxmox VE Firewall

**Proxmox VE Firewall** เป็นเครื่องมือสำคัญที่ช่วยให้คุณควบคุมการเข้าถึงเครือข่ายของโหนดและเครื่องเสมือน (VM) หรือคอนเทนเนอร์ (CT) ได้อย่างมีประสิทธิภาพ ทำความเข้าใจหลักการทำงานของมันเพื่อตั้งค่าได้อย่างถูกต้อ

## หลักการทำงานของ Proxmox VE Firewall

### 1. สถาปัตยกรรมแบบเลเยอร์ (Layered Architecture):

  - **ระดับ Datacenter:** คือการตั้งค่าไฟร์วอลล์สูงสุดที่จะมีผลกับทุกโหนดและ VM/CT ในคลัสเตอร์ของคุณ ยกเว้นกรณีที่มีการกำหนดกฎที่เฉพาะเจาะจงกว่าในระดับที่ต่ำกว่า

  - **ระดับ Node:** เป็นการตั้งค่าไฟร์วอลล์สำหรับโหนด Proxmox VE แต่ละตัวโดยเฉพาะ คุณสามารถมีกฎที่แตกต่างกันสำหรับแต่ละโหนดในคลัสเตอร์ของคุณได้

  - **ระดับ VM/Container:** คือการตั้งค่าไฟร์วอลล์สำหรับ Virtual Machine (VM) หรือ Container (CT) แต่ละตัว ซึ่งเป็นระดับที่เฉพาะเจาะจงที่สุดและมีความยืดหยุ่นสูง

### 2. การสืบทอดกฎ (Rule Inheritance):

  - กฎที่คุณกำหนดที่ **ระดับ Datacenter** จะถูกสืบทอดไปยังทุกโหนดและ VM/CT

  - กฎที่คุณกำหนดที่ **ระดับ Node** จะมีผลบังคับใช้เหนือกว่ากฎ Datacenter สำหรับโหนดนั้นๆ

  - กฎที่คุณกำหนดที่ **ระดับ VM/Container** จะมีผลบังคับใช้เหนือกว่าทั้งกฎ Node และ Datacenter สำหรับ VM/CT นั้นๆ

### 3. หลักการ "Default Deny" (ไม่อนุญาตโดยค่าเริ่มต้น):

โดยทั่วไป Proxmox VE Firewall จะใช้หลักการ "Default Deny" ซึ่งหมายความว่า **หากคุณไม่ได้กำหนดกฎอนุญาต (ACCEPT) การเชื่อมต่อใดๆ อย่างชัดเจน การเชื่อมต่อเหล่านั้นจะถูกปฏิเสธ (DENY/REJECT) โดยอัตโนมัติ** หลักการนี้ช่วยเพิ่มความปลอดภัยโดยบังคับให้ผู้ดูแลระบบต้องระบุ Traffic ที่อนุญาตเท่านั้น

### 4. ลำดับการประเมินกฎ (Rule Evaluation Order):

- **ระดับ VM/Container:** ตรวจสอบกฎที่กำหนดสำหรับ VM หรือ Container เป็นอันดับแรก (เฉพาะเจาะจงที่สุด)

- **ระดับ Node:** หากไม่พบกฎที่ตรงกันในระดับ VM/Container จะย้ายไปตรวจสอบกฎที่ระดับโหนด

- **ระดับ Datacenter:** หากไม่พบกฎที่ตรงกันในระดับ Node จะย้ายไปตรวจสอบกฎที่ระดับ Datacenter (กว้างที่สุด)

- **สำคัญ:** ทันทีที่พบกฎที่ตรงกัน ระบบจะใช้กฎนั้นและหยุดการตรวจสอบกฎอื่นๆ เพิ่มเติม ซึ่งหมายความว่ากฎที่เฉพาะเจาะจงกว่าจะมีผลบังคับใช้ก่อน

## ขั้นตอนการเปิดใช้งาน Firewall และตั้งค่าเบื้องต้น

<Steps>

### เข้าสู่ระบบ Proxmox VE Web UI

```url
http://<proxmox_ip_address>:8006
```

### เปิดใช้งาน Firewall ระดับ Datacenter

- ในเมนูด้านซ้ายมือ คลิกที่ **Datacenter**

- คลิกที่แท็บ **Firewall**

- เลือกช่อง **Enable Firewall** แล้วคลิก **Apply**

> **หมายเหตุ:** การเปิดใช้งาน ณ จุดนี้จะยังไม่บล็อกการเชื่อมต่อใดๆ

### ตรวจสอบและเพิ่มกฎ Firewall ที่จำเป็น

หลังจากเปิดใช้งาน Firewall แล้ว สิ่งสำคัญคือต้องเพิ่มกฎที่จำเป็นเพื่อให้ระบบของคุณยังคงทำงานได้อย่างปกติ การตั้งค่าสามารถทำได้ทั้งในระดับ Datacenter หรือ Node ขึ้นอยู่กับความต้องการของคุณ

- **SSH (Port 22):** เพื่อให้คุณสามารถเข้าถึงโหนด Proxmox ผ่าน SSH ได้

- **Proxmox VE Web UI (Port 8006):** เพื่อให้คุณสามารถเข้าถึงหน้าเว็บ Proxmox ได้

- **VM/CT Traffic:** หากคุณต้องการให้ VM/CT ของคุณสามารถเข้าถึงอินเทอร์เน็ตหรือบริการอื่นๆ ได้

### ตัวอย่างการเพิ่มกฎ

ที่แท็บ **Firewall** ของระดับที่คุณต้องการ (Datacenter หรือ Node)
  
- คลิก **Add**
  
- หน้าต่าง **"Add Firewall Rule"** จะปรากฎขึ้นมา:
  - Type: เลือก **"In" (สำหรับ inbound traffic)** หรือ **"Out" (สำหรับ outbound traffic)**
  - Action: เลือก **ACCEPT**
  - **Protocol:** เลือกตามความเหมาะสม เช่น TCP, UDP
  - **Port:** ระบุหมายเลขพอร์ต เช่น 22 สำหรับ SSH, 8006 สำหรับ Web UI
  - **Comment:** ใส่คำอธิบายสั้นๆ เพื่อให้จำได้ง่าย

- คลิก **Add** เพื่อบันทึกกฎ

</Steps>
